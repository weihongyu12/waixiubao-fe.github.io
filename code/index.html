<!DOCTYPE html>
<html lang="zh-cmn-Hans-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>代码 | 外修宝前端设计</title>
    <meta name="description" content="适用于外修宝 Web 平台开发">
    
    
    <link rel="preload" href="/assets/css/0.styles.4f64fecc.css" as="style"><link rel="preload" href="/assets/js/app.8ecca066.js" as="script"><link rel="preload" href="/assets/js/2.9c7904de.js" as="script"><link rel="preload" href="/assets/js/3.ec261dc9.js" as="script"><link rel="preload" href="/assets/js/6.f65d0484.js" as="script"><link rel="prefetch" href="/assets/js/10.530d5af2.js"><link rel="prefetch" href="/assets/js/11.ad1a12ed.js"><link rel="prefetch" href="/assets/js/12.6c14c233.js"><link rel="prefetch" href="/assets/js/13.bdc9e6cb.js"><link rel="prefetch" href="/assets/js/14.d9f9eba4.js"><link rel="prefetch" href="/assets/js/15.c6d96d19.js"><link rel="prefetch" href="/assets/js/16.0eff472c.js"><link rel="prefetch" href="/assets/js/17.41bab65c.js"><link rel="prefetch" href="/assets/js/18.17b66206.js"><link rel="prefetch" href="/assets/js/19.9dd2f75b.js"><link rel="prefetch" href="/assets/js/4.01399a86.js"><link rel="prefetch" href="/assets/js/5.8e29705f.js"><link rel="prefetch" href="/assets/js/7.ac456935.js"><link rel="prefetch" href="/assets/js/8.75dc153a.js"><link rel="prefetch" href="/assets/js/9.00c45a04.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4f64fecc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">外修宝前端设计</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/code/" class="nav-link router-link-exact-active router-link-active">代码</a></div><div class="nav-item"><a href="/build/" class="nav-link">构建流程</a></div><div class="nav-item"><a href="/test/" class="nav-link">测试</a></div><div class="nav-item"><a href="/features/" class="nav-link">功能设计</a></div><div class="nav-item"><a href="/document/" class="nav-link">文档</a></div><div class="nav-item"><a href="/restful-api/" class="nav-link">RESTful API</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/code/" class="nav-link router-link-exact-active router-link-active">代码</a></div><div class="nav-item"><a href="/build/" class="nav-link">构建流程</a></div><div class="nav-item"><a href="/test/" class="nav-link">测试</a></div><div class="nav-item"><a href="/features/" class="nav-link">功能设计</a></div><div class="nav-item"><a href="/document/" class="nav-link">文档</a></div><div class="nav-item"><a href="/restful-api/" class="nav-link">RESTful API</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>代码</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/code/#框架-库" class="sidebar-link">框架/库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/#开发环境" class="sidebar-link">开发环境</a></li><li class="sidebar-sub-header"><a href="/code/#主要技术栈" class="sidebar-link">主要技术栈</a></li><li class="sidebar-sub-header"><a href="/code/#框架" class="sidebar-link">框架</a></li><li class="sidebar-sub-header"><a href="/code/#ui组件" class="sidebar-link">UI组件</a></li><li class="sidebar-sub-header"><a href="/code/#主要第三方库" class="sidebar-link">主要第三方库</a></li></ul></li><li><a href="/code/#数据交互" class="sidebar-link">数据交互</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/#restful" class="sidebar-link">RESTful</a></li><li class="sidebar-sub-header"><a href="/code/#graphql" class="sidebar-link">GraphQL</a></li><li class="sidebar-sub-header"><a href="/code/#websocket" class="sidebar-link">WebSocket</a></li></ul></li><li><a href="/code/#prpl-模式" class="sidebar-link">PRPL 模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/#push-preload" class="sidebar-link">Push/Preload</a></li><li class="sidebar-sub-header"><a href="/code/#render" class="sidebar-link">Render</a></li><li class="sidebar-sub-header"><a href="/code/#precache" class="sidebar-link">Precache</a></li><li class="sidebar-sub-header"><a href="/code/#lazy-load" class="sidebar-link">Lazy-Load</a></li></ul></li><li><a href="/code/#性能" class="sidebar-link">性能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/#网页内容" class="sidebar-link">网页内容</a></li><li class="sidebar-sub-header"><a href="/code/#服务器" class="sidebar-link">服务器</a></li><li class="sidebar-sub-header"><a href="/code/#cookie" class="sidebar-link">Cookie</a></li><li class="sidebar-sub-header"><a href="/code/#图片" class="sidebar-link">图片</a></li></ul></li><li><a href="/code/#安全" class="sidebar-link">安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/#使用-https" class="sidebar-link">使用 HTTPS</a></li><li class="sidebar-sub-header"><a href="/code/#启用跨域" class="sidebar-link">启用跨域</a></li><li class="sidebar-sub-header"><a href="/code/#启用子资源完整性校验" class="sidebar-link">启用子资源完整性校验</a></li><li class="sidebar-sub-header"><a href="/code/#xss" class="sidebar-link">XSS</a></li><li class="sidebar-sub-header"><a href="/code/#内容安全策略-csp" class="sidebar-link">内容安全策略 CSP</a></li></ul></li><li><a href="/code/#兼容性" class="sidebar-link">兼容性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/#兼容级别" class="sidebar-link">兼容级别</a></li><li class="sidebar-sub-header"><a href="/code/#browserslist配置" class="sidebar-link">browserslist配置</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="代码"><a href="#代码" aria-hidden="true" class="header-anchor">#</a> 代码</h1> <h2 id="框架-库"><a href="#框架-库" aria-hidden="true" class="header-anchor">#</a> 框架/库</h2> <p><img src="/assets/img/framework.003085d9.png" alt="应用框架"></p> <h3 id="开发环境"><a href="#开发环境" aria-hidden="true" class="header-anchor">#</a> 开发环境</h3> <ul><li><a href="https://nodejs.org/" target="_blank" rel="noopener noreferrer">Node.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：12.13.0以上</li> <li><a href="https://www.yarnpkg.com/zh-Hans/" target="_blank" rel="noopener noreferrer">yarn<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>IDE：推荐 <a href="http://www.jetbrains.com/webstorm/" target="_blank" rel="noopener noreferrer">JetBrains WebStorm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 或者 <a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreferrer">Visual Studio Code<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nginx.org/" target="_blank" rel="noopener noreferrer">nginx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：用于服务器部署</li></ul> <h3 id="主要技术栈"><a href="#主要技术栈" aria-hidden="true" class="header-anchor">#</a> 主要技术栈</h3> <ul><li>构建方案：<a href="https://webpack.js.org/" target="_blank" rel="noopener noreferrer">Webpack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>框架：<a href="https://cn.vuejs.org/" target="_blank" rel="noopener noreferrer">Vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>UI组件库：<a href="https://didi.github.io/mand-mobile/" target="_blank" rel="noopener noreferrer">Mand Mobile<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>路由：<a href="https://router.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">Vue Router<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>状态管理：<a href="https://vuex.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">Vuex<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>CSS预处理器：<a href="https://sass-lang.com/" target="_blank" rel="noopener noreferrer">Scss<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>静态检查：<a href="https://cn.eslint.org/" target="_blank" rel="noopener noreferrer">ESLint<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> + <a href="http://airbnb.io/javascript/" target="_blank" rel="noopener noreferrer">Airbnb JavaScript Style Guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> + <a href="https://cn.vuejs.org/v2/style-guide/" target="_blank" rel="noopener noreferrer">Vue Style Guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>单元测试：<a href="https://mochajs.org/" target="_blank" rel="noopener noreferrer">Mocha<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> + <a href="https://vue-test-utils.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">Vue Test Utils<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="框架"><a href="#框架" aria-hidden="true" class="header-anchor">#</a> 框架</h3> <p>框架采用 <a href="https://vuejs.org/" target="_blank" rel="noopener noreferrer">Vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>主要采用以下特性：</p> <ul><li>单文件组件</li> <li>路由</li> <li>状态管理</li> <li>虚拟 DOM</li> <li>响应式 (Reactive) 和组件化 (Composable) 的视图组件</li></ul> <p>不使用以下特性：</p> <ul><li>TypeScript</li> <li>服务端渲染</li></ul> <p><img src="/assets/img/mvvm.4fbd3c1b.png" alt="MVVM"></p> <h3 id="ui组件"><a href="#ui组件" aria-hidden="true" class="header-anchor">#</a> UI组件</h3> <p>UI组件采用 <a href="https://didi.github.io/mand-mobile" target="_blank" rel="noopener noreferrer">Mand Mobile<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，Mand Mobile 是滴滴出品的一款适用于金融场景的Vue.js组件，可以满足外修宝，汽修和金融两个场景的需求。</p> <p><a href="https://fontawesome.com/" target="_blank" rel="noopener noreferrer">Font Awesome<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一款流行的图标库，拥有多达一千二百多个免费图标，其中 Automotive 类目下的图标适合外修宝使用。使用 Font Awesome 应该注意，应该按需引入使用的图标，避免文件过大。</p> <p><a href="https:necolas.github.io/normalize.css/" target="_blank" rel="noopener noreferrer">normalize.css<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是 Mand Mobile 推荐的 reset 样式，予以采用。</p> <p>其他UI组件为自定义样式组件或者局部组件，在此不再一一赘述。</p> <h3 id="主要第三方库"><a href="#主要第三方库" aria-hidden="true" class="header-anchor">#</a> 主要第三方库</h3> <p><a href="https://github.com/ftlabs/fastclick" target="_blank" rel="noopener noreferrer">Fast Click<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 用于解决移动浏览器点击延迟的问题。</p> <p><a href="https://localforage.github.io/localForage/" target="_blank" rel="noopener noreferrer">localForage<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 用于本地 indexedDB 存储，可以跟 PWA 配合。</p> <p><a href="https://github.com/github/fetch" target="_blank" rel="noopener noreferrer">whatwg-fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 用于不支持 Fetch API 浏览器的 Fetch Polyfill。</p> <p>以上三款均是全局第三方库，其他第三方库正在整理</p> <h2 id="数据交互"><a href="#数据交互" aria-hidden="true" class="header-anchor">#</a> 数据交互</h2> <p><img src="/assets/img/data-interaction.1b90e385.png" alt="应用框架"></p> <p>与服务器的通信交互以HTTP协议为主，同时辅助其他方式。</p> <h3 id="restful"><a href="#restful" aria-hidden="true" class="header-anchor">#</a> RESTful</h3> <p>请求 RESTful API 总是以 HTTP 方式：</p> <div class="language-http request extra-class"><pre class="language-http"><code>GET /article 列出所有文章
GET /article/${ID} 获取某个指定文章的信息
POST /article 新建文章
PUT /article/${ID} 更新某个指定文章的信息
DELETE /article/${ID} 删除指定文章
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 构建 HTTP 请求，这是一个新的推荐方式，并且支持PWA。</p></div> <h3 id="graphql"><a href="#graphql" aria-hidden="true" class="header-anchor">#</a> GraphQL</h3> <p>GraphQL 是一种新型的查询语言，目标是用于取代 RESTful，可用于一些不重要的功能接口上做尝试。</p> <h3 id="websocket"><a href="#websocket" aria-hidden="true" class="header-anchor">#</a> WebSocket</h3> <p>对于实时通信应该使用 WebSocket，尽量避免轮询和长轮询。</p> <h2 id="prpl-模式"><a href="#prpl-模式" aria-hidden="true" class="header-anchor">#</a> PRPL 模式</h2> <p>“PRPL”实际上是 Push/Preload、Render、Precache、Lazy-Load 的缩写，将贯穿于性能优化的全部阶段</p> <h3 id="push-preload"><a href="#push-preload" aria-hidden="true" class="header-anchor">#</a> Push/Preload</h3> <p>推送/预加载初始 URL 路由所需的关键资源。</p> <p>我们希望提前请求一些隐藏在应用依赖关系（Dependency Graph）较深处的资源，以节省 HTTP 往返、浏览器解析文档、或脚本执行的时间。如果我们可以在 webpack 清单、路由等入口代码（entry chunks）被下载与运行之前就把初始 URL，即用户访问的入口 URL 路由所依赖的代码用 Server Push 推送或 <code>&lt;link rel=&quot;preload&quot;&gt;</code> 进行提前加载。那么当这些资源被真正请求时，它们可能已经下载好并存在在缓存中了，这样就加快了初始路由所有依赖的就绪。</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <ul><li>开启 DNS 预读取</li> <li>开启 HTTP/2 Server Push</li> <li>开启 preconnect</li> <li>开启 preload</li> <li>开启 prefetch</li></ul></div> <h3 id="render"><a href="#render" aria-hidden="true" class="header-anchor">#</a> Render</h3> <p>渲染初始路由，尽快让应用可被交互。</p> <p>既然所有初始路由的依赖都已经就绪，我们就可以尽快开始初始路由的渲染，这有助于提升应用诸如首次渲染时间、可交互时间等指标。多页应用并不使用基于 JavaScript 的路由，而是传统的 HTML 跳转机制，所以对于这一部分，多页应用其实不用额外做什么。</p> <h3 id="precache"><a href="#precache" aria-hidden="true" class="header-anchor">#</a> Precache</h3> <p>用 Service Worker 预缓存剩下的路由。</p> <p>这一部分就需要 Service Worker 的参与了，Service Worker 是一个位于浏览器与网络之间的客户端代理，它以可拦截、处理、响应流经的 HTTP 请求，使得开发者得以从缓存中向 web 应用提供资源而闻名。不过，Service Worker 其实也可以主动发起 HTTP 请求，在“后台” 预请求与预缓存我们未来所需要的资源。</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <ul><li>启用 PWA</li></ul></div> <h3 id="lazy-load"><a href="#lazy-load" aria-hidden="true" class="header-anchor">#</a> Lazy-Load</h3> <p>按需懒加载、懒实例化剩下的路由。</p> <p>懒加载与懒实例化剩下的路由需要实现基于路由的 code splitting 与异步加载。</p> <p>值得说明的是，无论单页还是多页应用，如果在上一步中，我们已经将这些路由的资源都预先下载与缓存好了，那么懒加载就几乎是瞬时完成的了，这时候我们就只需要付出实例化的代价。</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <ul><li>使用路由懒加载</li></ul></div> <h2 id="性能"><a href="#性能" aria-hidden="true" class="header-anchor">#</a> 性能</h2> <h3 id="网页内容"><a href="#网页内容" aria-hidden="true" class="header-anchor">#</a> 网页内容</h3> <h4 id="使用pwa"><a href="#使用pwa" aria-hidden="true" class="header-anchor">#</a> 使用PWA</h4> <p>PWA 在构建时已经默认使用，PWA 将为外修宝带来以下优点：</p> <ul><li><strong>渐进式</strong> - 适用于所有浏览器，因为它是以渐进式增强作为宗旨开发的</li> <li><strong>连接无关性</strong> - 能够借助 Service Worker 在离线或者网络较差的情况下正常访问</li> <li><strong>类似应用</strong> - 由于是在 App Shell 模型基础上开发，因为应具有 Native App 的交互和导航，给用户 Native App 的体验</li> <li><strong>持续更新</strong> - 始终是最新的，无版本和更新问题</li> <li><strong>安全</strong> - 通过 HTTPS 协议提供服务，防止窥探和确保内容不被篡改</li> <li><strong>可索引</strong> - 应用清单文件和 Service Worker 可以让搜索引擎索引到，从而将其识别为『应用』</li> <li><strong>粘性</strong> - 通过推送离线通知等，可以让用户回流</li> <li><strong>可安装</strong> - 用户可以添加常用的 webapp 到桌面，免去去应用商店下载的麻烦</li> <li><strong>可链接</strong> - 通过链接即可分享内容，无需下载安装</li></ul> <div class="danger custom-block"><p class="custom-block-title">WARNING</p> <p>无论何时都不能关闭PWA。</p></div> <h4 id="代码分割"><a href="#代码分割" aria-hidden="true" class="header-anchor">#</a> 代码分割</h4> <p>当打包构建应用时，JavaScript 包会变得非常大，影响页面加载。如果我们能把不同路由对应的组件分割成不同的代码块，然后当路由被访问的时候才加载对应组件，这样就更加高效了。</p> <p>结合 Vue 的异步组件 和 Webpack 的代码分割功能 ，轻松实现路由组件的懒加载。</p> <p>结合这两者，这就是如何定义一个能够被 Webpack 自动代码分割的异步组件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">Foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./Foo.vue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在路由配置中什么都不需要改变，只需要像往常一样使用：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/foo'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> Foo <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="dns预读取"><a href="#dns预读取" aria-hidden="true" class="header-anchor">#</a> DNS预读取</h4> <p>DNS 预读取是一项使浏览器主动去执行域名解析的功能，其范围包括文档的所有链接，无论是图片的，CSS 的，还是 JavaScript 等其他用户能够点击的 URL。</p> <p>因为预读取会在后台执行，所以 DNS 很可能在链接对应的东西出现之前就已经解析完毕。这能够减少用户点击链接时的延迟。</p> <p>DNS 请求需要的带宽非常小，但是延迟却有点高，这点在手机网络上特别明显。预读取 DNS 能让延迟明显减少一些。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dns-prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//cdn.waixiubao.com<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dns-prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//api.waixiubao.com<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="帮助浏览器尽早提供关键资源"><a href="#帮助浏览器尽早提供关键资源" aria-hidden="true" class="header-anchor">#</a> 帮助浏览器尽早提供关键资源</h4> <p><code>preconnect</code> 提示浏览器在后台开始连接握手（DNS，TCP，TLS）以提高性能。</p> <p><code>preload</code> 可以指明哪些资源是在页面加载完成后即刻需要的。对于这种即刻需要的资源，你可能希望在页面加载的生命周期的早期阶段就开始获取，在浏览器的主渲染机制介入前就进行预加载。这一机制使得资源可以更早的得到加载并可用，且更不易阻塞页面的初步渲染，进而提升性能。</p> <p><code>prefetch</code> 链接预取是一种浏览器机制，其利用浏览器空闲时间来下载或预取用户在不久的将来可能访问的文档。网页向浏览器提供一组预取提示，并在浏览器完成当前页面的加载后开始静默地拉取指定的文档并将其存储在缓存中。当用户访问其中一个预取文档时，便可以快速的从浏览器缓存中得到。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>preconnect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//cdn.waixiubao.com/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>preconnect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//api.waixiubao.com/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>@vue/cli 为 <code>preload</code> 和 <code>prefetch</code> 提供默认支持。</p></div> <h4 id="启用keep-alive"><a href="#启用keep-alive" aria-hidden="true" class="header-anchor">#</a> 启用keep-alive</h4> <p>当你用 <code>&lt;keep-alive&gt;</code> 包裹一个组件后，它的状态就会保留，因此就留在了内存里。</p> <p><code>&lt;keep-alive&gt;</code> 包裹动态组件时，会缓存不活动的组件实例，而不是销毁它们。<code>&lt;keep-alive&gt;</code> 是一个抽象组件：它自身不会渲染一个 DOM 元素，也不会出现在父组件链中。</p> <p>这个技巧可以用来提升用户体验。主要用于保留组件状态或避免重新渲染。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>当组件在 <code>&lt;keep-alive&gt;</code> 内被切换，它的 <code>activated</code> 和 <code>deactivated</code> 这两个生命周期钩子函数将会被对应执行。</p></div> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>对于一些消耗内存的操作，仍然要注意不活动的组件的内存开销，可以在 <code>deactivated</code> 和 <code>beforeDestroy</code> 生命周期钩子销毁存在内存泄漏的实例。</p></div> <h3 id="服务器"><a href="#服务器" aria-hidden="true" class="header-anchor">#</a> 服务器</h3> <p><img src="/assets/img/http-cache.838d7958.svg" alt="HTTP缓存策略"></p> <h4 id="使用cdn"><a href="#使用cdn" aria-hidden="true" class="header-anchor">#</a> 使用CDN</h4> <p>对于静态资源，尽量使用 CDN 进行网络加速。CDN 通过部署在不同地区的服务器来提高客户的下载速度。</p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>CDN的采购需要一定的成本。</p></div> <h4 id="使用http-2"><a href="#使用http-2" aria-hidden="true" class="header-anchor">#</a> 使用HTTP/2</h4> <p>静态资源的加载可以采用 HTTP/2，HTTP/2 将带来如下优势：</p> <ul><li><strong>新的二进制格式（Binary Format）</strong>，HTTP1.x 的解析是基于文本。基于文本协议的格式解析存在天然缺陷，文本的表现形式有多样性，要做到健壮性考虑的场景必然很多，二进制则不同，只认0和1的组合。基于这种考虑 HTTP2.0 的协议解析决定采用二进制格式，实现方便且健壮。</li> <li><strong>多路复用（MultiPlexing）</strong>，即连接共享，即每一个 request 都是是用作连接共享机制的。一个 request 对应一个 id，这样一个连接上可以有多个 request，每个连接的 request 可以随机的混杂在一起，接收方可以根据 request 的 id 将 request 再归属到各自不同的服务端请求里面。</li> <li><strong>header 压缩</strong>，HTTP2.0 使用 encoder 来减少需要传输的 header 大小，通讯双方各自 cache 一份 header fields 表，既避免了重复 header 的传输，又减小了需要传输的大小。</li> <li><strong>服务端推送（server push）</strong>，服务端会将资源文件推送给客户端，当客户端再次尝试获取资源时就可以直接从缓存中获取到，不用再发请求了。</li></ul> <p>当使用了 HTTP/2 之后，以下优化手段将不再适用：</p> <ul><li>合并精灵图</li> <li>内联代码</li> <li>适用多个域名加速文件下载</li></ul> <div class="language- extra-class"><pre class="language-text"><code>server {
  listen              443 ssl http2;
  ssl_certificate     server.crt;
  ssl_certificate_key server.key;
  http2_push_preload  on 
}
</code></pre></div><h4 id="添加-cache-control-和-expires"><a href="#添加-cache-control-和-expires" aria-hidden="true" class="header-anchor">#</a> 添加 Cache-Control 和 Expires</h4> <p>使用HTTP缓存，有助于提高网络请求性能，需要配置 <code>Cache-Control</code> 和 <code>Expires</code> 响应头，并设置一个较长的过期时间。</p> <div class="language- extra-class"><pre class="language-text"><code># nginx.conf
server {
  expires max;
}
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Cache-Control 的优先级高于 Expires。</p></div> <h4 id="配置-etags"><a href="#配置-etags" aria-hidden="true" class="header-anchor">#</a> 配置 ETags</h4> <div class="language- extra-class"><pre class="language-text"><code># nginx.conf
server {
  etag on;
}
</code></pre></div><h4 id="brotli-和-gzip-压缩传输文件"><a href="#brotli-和-gzip-压缩传输文件" aria-hidden="true" class="header-anchor">#</a> Brotli 和 Gzip 压缩传输文件</h4> <p>Gzip 通常可以减少 70% 网页内容的大小，包括脚本、样式表、图片等文件。Gzip 比 deflate 更高效，主流服务器都有相应的压缩支持模块。</p> <p>Brotli 可以提供比 gzip 和 deflate 更有效的无损压缩算法。</p> <div class="language- extra-class"><pre class="language-text"><code># nginx.conf
server {
  brotli on;
  brotli_comp_level: 11;
  brotli_types text/plain text/html text/javascript text/css text/xml text/x-component application/javascript application/x-javascript application/xml application/json application/xhtml+xml application/rss+xml application/atom+xml application/x-font-ttf application/vnd.ms-fontobject image/svg+xml image/x-icon font/opentype font/x-woff font/ttf;
  brotli_static on;

  gzip on;
  gzip_comp_level 9;
  gzip_types text/plain text/html text/javascript text/css text/xml text/x-component application/javascript application/x-javascript application/xml application/json application/xhtml+xml application/rss+xml application/atom+xml application/x-font-ttf application/vnd.ms-fontobject image/svg+xml image/x-icon font/opentype font/x-woff font/ttf;
  gzip_vary on;
  gzip_static on;
}
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>启用 Brotli 应该先安装 <a href="https://github.com/google/ngx_brotli" target="_blank" rel="noopener noreferrer">ngx_brotli<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 模块</p></div> <p>可以使用 <a href="https://github.com/webpack-contrib/compression-webpack-plugin" target="_blank" rel="noopener noreferrer">compression-webpack-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 进行预压缩，减少服务器CPU的压力</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>

<span class="token comment">// $ yarn add compression-webpack-plugin -D</span>
<span class="token keyword">const</span> CompressionPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'compression-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  configureWebpack<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// brotli 预压缩</span>
      <span class="token keyword">new</span> <span class="token class-name">CompressionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[path].br[query]'</span><span class="token punctuation">,</span>
        algorithm<span class="token punctuation">:</span> <span class="token string">'brotliCompress'</span><span class="token punctuation">,</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.(js|css|svg)$/</span><span class="token punctuation">,</span>
        cache<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        compressionOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span> level<span class="token punctuation">:</span> <span class="token number">11</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        threshold<span class="token punctuation">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
        minRatio<span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// gzip 预压缩</span>
      <span class="token keyword">new</span> <span class="token class-name">CompressionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[path].gz[query]'</span><span class="token punctuation">,</span>
        algorithm<span class="token punctuation">:</span> <span class="token string">'gzip'</span><span class="token punctuation">,</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.(js|css|svg)$/</span><span class="token punctuation">,</span>
        cache<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        compressionOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span> level<span class="token punctuation">:</span> <span class="token number">9</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        threshold<span class="token punctuation">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
        minRatio<span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="cookie"><a href="#cookie" aria-hidden="true" class="header-anchor">#</a> Cookie</h3> <h4 id="减少-cookie-大小"><a href="#减少-cookie-大小" aria-hidden="true" class="header-anchor">#</a> 减少 Cookie 大小</h4> <ul><li>去除没有必要的 cookie，如果网页不需要 cookie 就完全禁掉</li> <li>将 cookie 的大小减到最小</li> <li>注意 cookie 设置的 domain 级别，没有必要情况下不要影响到 sub-domain</li> <li>设置合适的过期时间，比较长的过期时间可以提高响应速度。</li></ul> <h3 id="图片"><a href="#图片" aria-hidden="true" class="header-anchor">#</a> 图片</h3> <h4 id="使用-webp"><a href="#使用-webp" aria-hidden="true" class="header-anchor">#</a> 使用 WebP</h4> <p>优先启用 WebP 格式的图像文件，获取更高的压缩率，从而减少请求时间。</p> <p>下载 <a href="https://developers.google.com/speed/webp/" target="_blank" rel="noopener noreferrer">WebP 插件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>并通过命令行转化图像文件为webp格式。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>cwebp -q <span class="token number">100</span> image.png -o image.webp
</code></pre></div><p>在 HTML 中启用 WebP：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>picture</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.webp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image/webp<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image/png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image alt<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>picture</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="使用-html5-视频代替-gif-动画"><a href="#使用-html5-视频代替-gif-动画" aria-hidden="true" class="header-anchor">#</a> 使用 HTML5 视频代替 GIF 动画</h4> <p>用 GIF 作为视频存储格式太可怕了，它们的大小通常非常巨大，导致较慢的页面加载时间和较高的流量。 使用 HTML5 视频，你可以将 GIF 的体积减小高达 98%，同时仍然保留浏览器中 GIF 格式的独特品质。</p> <p><a href="https://ffmpeg.org/" target="_blank" rel="noopener noreferrer">ffmpeg<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个免费的开源命令行工具，专为处理视频和音频文件而设计。它可用于将 GIF 动画转换为视频格式。</p> <p>将 GIF 转换为 MP4：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>ffmpeg -i animated.gif video.mp4
</code></pre></div><p>将 GIF 转换为 WebM：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>ffmpeg -i animated.gif -c vp9 -b:v <span class="token number">0</span> video.webm
</code></pre></div><p>将 GIF 转换为 Ogg：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>ffmpeg -i animated.gif -acodec libogg video.ogv
</code></pre></div><p>在 HTML 中启用视频：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>video.webm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>video/webm<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>video.ogv<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>video/ogg; codecs='theora, vorbis'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>video.mp4<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>video/mp4<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>animated.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image alt<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="处理自适应图形"><a href="#处理自适应图形" aria-hidden="true" class="header-anchor">#</a> 处理自适应图形</h4> <p>在图片加载时，可以根据设备加载合适的图片，从而减少请求图片的文件大小。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>picture</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.webp 1x, image@2x.webp 2x, image@3x.webp 3x<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image/webp<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.png 1x, image@2x.png 2x, image@3x.png 3x<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image/png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.png 1x, image@2x.png 2x, image@3x.png 3x<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image alt<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>picture</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.png 1x, image@2x.png 2x, image@3x.png 3x<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image alt<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.picture</span> <span class="token punctuation">{</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token string">'image@3x.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">image-set</span><span class="token punctuation">(</span><span class="token string">'image.png'</span> 1x<span class="token punctuation">,</span> <span class="token string">'image@2x.png'</span> 2x<span class="token punctuation">,</span> <span class="token string">'image@3x.png'</span> 3x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="懒加载屏幕外的图片"><a href="#懒加载屏幕外的图片" aria-hidden="true" class="header-anchor">#</a> 懒加载屏幕外的图片</h4> <p>轮播动画，滑块或非常长的页面等屏幕外的内容通常会加载图像，即使用户并不能立即在页面上看到它们。</p> <p>浏览器本身尚不支持懒加载，因此我们使用 JavaScript 来添加此功能。我们使用 <a href="https://www.npmjs.com/package/lazysizes" target="_blank" rel="noopener noreferrer">lazysizes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 添加懒加载行为。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> lazysizes <span class="token keyword">from</span> <span class="token string">'lazysizes'</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>picture</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">data-sizes</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>auto<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.webp 1x, image@2x.webp 2x, image@3x.webp 3x<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image/webp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>lazyload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">data-sizes</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>auto<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.png 1x, image@2x.png 2x, image@3x.png 3x<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image/png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>lazyload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">data-sizes</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>auto<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.png 1x, image@2x.png 2x, image@3x.png 3x<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image alt<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>lazyload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>picture</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.png 1x, image@2x.png 2x, image@3x.png 3x<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image alt<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>lazyload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="安全"><a href="#安全" aria-hidden="true" class="header-anchor">#</a> 安全</h2> <h3 id="使用-https"><a href="#使用-https" aria-hidden="true" class="header-anchor">#</a> 使用 HTTPS</h3> <p>所有 API 和静态资源的请求，<strong>必须开启 HTTPS</strong>。</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>建议 HTTPS 使用 TLS v1.3 协议。</p></div> <div class="language- extra-class"><pre class="language-text"><code># nginx.conf
server {
  listen                    443 ssl http2;
  ssl_certificate           server.crt;
  ssl_certificate_key       server.key;
  ssl_protocols             TLSv1.3;
  ssl_prefer_server_ciphers on; 
  ssl_dhparam               /etc/nginx/dhparam.pem; # openssl dhparam -out /etc/nginx/dhparam.pem 4096
  ssl_ciphers               ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384;
  ssl_ecdh_curve            secp384r1;
  ssl_session_timeout       10m;
  ssl_session_cache         shared:SSL:10m;
  ssl_session_tickets       off; 
  ssl_stapling              on; 
  ssl_stapling_verify       on; 
  resolver                  $DNS-IP-1 $DNS-IP-2 valid=300s;
  resolver_timeout          5s; 
  add_header                Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;;
}
</code></pre></div><h3 id="启用跨域"><a href="#启用跨域" aria-hidden="true" class="header-anchor">#</a> 启用跨域</h3> <p>在 HTML5 中，一些 HTML 元素提供了对 CORS 的支持， 它允许你配置元素获取数据的 CORS 请求。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  crossorigin<span class="token punctuation">:</span> <span class="token string">'anonymous'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>生成的 HTML 会在 <code>&lt;link&gt;</code> 和 <code>&lt;script&gt;</code> 添加 <code>crossorigin</code> 属性，浏览器将执行一个远程脚本的脚本而不发送用户凭据。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.waixiubao.com/example.js<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>anonymous<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>如果需要发送用户凭据需要将 <code>crossorigin</code> 设置为 <code>use-credentials</code>。</p></div> <h3 id="启用子资源完整性校验"><a href="#启用子资源完整性校验" aria-hidden="true" class="header-anchor">#</a> 启用子资源完整性校验</h3> <p>子资源完整性(SRI)是允许浏览器检查其获得的资源（例如从 CDN 获得的）是否被篡改的一项安全特性。它通过验证获取文件的哈希值是否和你提供的哈希值一样来判断资源是否被篡改。</p> <p>通过以下配置，启用子资源完整性：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  integrity<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><p>服务器在 CSP 头部添加 require-sri-for 指令进行验证：</p> <div class="language- extra-class"><pre class="language-text"><code># nginx.conf
server {
  add_header Content-Security-Policy &quot;require-sri-for script style&quot;;
}
</code></pre></div><p>启用子资源完整性验证，生成的 HTML 会在 <code>&lt;link&gt;</code> 和 <code>&lt;script&gt;</code> 添加 <code>integrity</code> 属性。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.waixiubao.com/example.js<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sha384-oqVuAfXRKap7fdgcCY5uykM6+R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>anonymous<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>当启用 SRI 时，preload resource hints 会被禁用，因为 <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=677022" target="_blank" rel="noopener noreferrer">Chrome 的一个 bug<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 会导致文件被下载两次。</p></div> <h3 id="xss"><a href="#xss" aria-hidden="true" class="header-anchor">#</a> XSS</h3> <h4 id="v-html"><a href="#v-html" aria-hidden="true" class="header-anchor">#</a> v-html</h4> <p>慎用 <code>v-html</code> ，动态渲染的任意 HTML 可能会非常危险，因为它很容易导致 XSS 攻击。请只对可信内容使用 HTML 插值，<strong>绝不要</strong>对用户提供的内容使用插值。</p> <div class="danger custom-block"><p class="custom-block-title">WARNING</p> <p>动态渲染的任意 HTML 可能会非常危险，因为它很容易导致 XSS 攻击。请只对可信内容使用 HTML 插值，<strong>绝不要</strong>对用户提供的内容使用插值。</p></div> <h4 id="csp"><a href="#csp" aria-hidden="true" class="header-anchor">#</a> CSP</h4> <p>参见 <a href="#%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5-csp">CSP</a></p> <h4 id="x-frame-options"><a href="#x-frame-options" aria-hidden="true" class="header-anchor">#</a> X-Frame-Options</h4> <p>X-Frame-Options HTTP 响应头是用来给浏览器指示允许一个页面可否在 <code>&lt;frame&gt;</code>, <code>&lt;iframe&gt;</code> 或者 <code>&lt;object&gt;</code> 中展现的标记。网站可以使用此功能，来确保自己网站的内容没有被嵌到别人的网站中去，也从而避免了点击劫持 (clickjacking) 的攻击。</p> <p>X-Frame-Options 有三个值:</p> <p><strong><code>DENY</code></strong></p> <p>表示该页面不允许在 <code>frame</code> 中展示，即便是在相同域名的页面中嵌套也不允许。</p> <p><strong><code>SAMEORIGIN</code></strong></p> <p>表示该页面可以在相同域名页面的 <code>frame</code> 中展示。</p> <p><strong><code>ALLOW-FROM uri</code></strong></p> <p>表示该页面可以在指定来源的 <code>frame</code> 中展示。</p> <div class="language- extra-class"><pre class="language-text"><code># nginx.conf
server {
  add_header X-Frame-Options DENY;
}
</code></pre></div><h4 id="x-download-options-noopen"><a href="#x-download-options-noopen" aria-hidden="true" class="header-anchor">#</a> X-Download-Options:noopen</h4> <p>禁用下载框 Open 按钮，防止下载文件默认被打开 XSS。</p> <div class="language- extra-class"><pre class="language-text"><code># nginx.conf
server {
  add_header X-Download-Options noopen;
}
</code></pre></div><h4 id="x-content-type-options-nosniff"><a href="#x-content-type-options-nosniff" aria-hidden="true" class="header-anchor">#</a> X-Content-Type-Options:nosniff</h4> <p>禁用浏览器自动嗅探 MIME 功能例如 <code>text/plain</code> 却当成 <code>text/html</code> 渲染，特别当本站点 serve 的内容未必可信的时候。</p> <div class="language- extra-class"><pre class="language-text"><code># nginx.conf
server {
  add_header X-Content-Type-Options nosniff;
}
</code></pre></div><h4 id="x-xss-protection"><a href="#x-xss-protection" aria-hidden="true" class="header-anchor">#</a> X-XSS-Protection</h4> <p>浏览器提供的一些 XSS 检测与防范。</p> <div class="language- extra-class"><pre class="language-text"><code># nginx.conf
server {
  add_header X-XSS-Protection &quot;1; mode=block&quot;;
}
</code></pre></div><h3 id="内容安全策略-csp"><a href="#内容安全策略-csp" aria-hidden="true" class="header-anchor">#</a> 内容安全策略 CSP</h3> <p>内容安全策略 (CSP)  是一个附加的安全层，用于帮助检测和缓解某些类型的攻击，包括跨站脚本 (XSS) 和数据注入等攻击。 这些攻击可用于实现从数据窃取到网站破坏或作为恶意软件分发版本等用途。</p> <p>CSP 的主要目标是减少和报告 XSS 攻击。XSS 攻击利用浏览器对从服务器接受的内容的信任。恶意的脚本在受害的浏览器被执行, 因为浏览器相信内容源，甚至当内容源并不是从它应该来的地方过来的。</p> <p>CSP 使服务器管理员能够通过制定浏览器能够执行的可信赖脚本的域名来减少或者消除由 XSS 可能出现的矢量。 一个兼容 CSP 的浏览器将只会执行加载与白名单域名的源文件的脚本，忽略那些其他的脚本（包括内联脚本和事件操控 HTML 属性）。</p> <p>作为一种最终的保护，想要禁止脚本的站点可以选择全局禁止脚本执行。</p> <p>为了重新约束内容被下载的域名, 服务端能够制定那种协议能够被使用；例如（理论上，从安全的立足点来看），一个服务制定所有的内容都通过 HTTPS 协议来加载。从而减少数据包监听攻击。</p> <p>使用 CSP 需要使用 <code>Content-Security-Policy</code>，同时，现代浏览器使用一段内联脚本来避免 Safari 10 重复加载脚本包，所以如果你在使用一套严格的 CSP，你需要这样显性地允许内联脚本，此外，子资源完整性(SRI)校验也是通过 CSP 配置完成的，所以完整的CSP请求头如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Content-Security-Policy: script-src 'self' 'https://cdn.waixiubao.com' 'sha256-4RS22DYeB7U14dra4KcQYxmwt5HkOInieXK1NUMBmQI=';require-sri-for script style;
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code># nginx.conf
server {
  add_header Content-Security-Policy &quot;script-src 'self' 'https://cdn.waixiubao.com' 'sha256-4RS22DYeB7U14dra4KcQYxmwt5HkOInieXK1NUMBmQI=';require-sri-for script style&quot;;
}
</code></pre></div><h2 id="兼容性"><a href="#兼容性" aria-hidden="true" class="header-anchor">#</a> 兼容性</h2> <p>兼容性采用<strong>优雅降级</strong>方案：一开始就构建站点的完整功能，然后针对浏览器进行降级处理。</p> <h3 id="兼容级别"><a href="#兼容级别" aria-hidden="true" class="header-anchor">#</a> 兼容级别</h3> <table><thead><tr><th>浏览器</th> <th>级别</th></tr></thead> <tbody><tr><td>Google Chorme</td> <td>B</td></tr> <tr><td>Chrome for Android</td> <td>A</td></tr> <tr><td>Safari</td> <td>B</td></tr> <tr><td>iOS Safari</td> <td>A</td></tr> <tr><td>Firefox</td> <td>B</td></tr> <tr><td>Edge</td> <td>C</td></tr> <tr><td>Internet Explorer</td> <td>D</td></tr> <tr><td>UC Browser for Android</td> <td>A</td></tr> <tr><td>QQ Browser</td> <td>A</td></tr> <tr><td>X5 TBS</td> <td>A</td></tr></tbody></table> <ul><li>A：提供完全支持</li> <li>B：提供完全支持，但不进行兼容性测试</li> <li>C：提供有限支持</li> <li>D：不支持</li></ul> <h3 id="browserslist配置"><a href="#browserslist配置" aria-hidden="true" class="header-anchor">#</a> browserslist配置</h3> <p>浏览器只兼容最近 2 个版本和市场占有率大于 1% 的版本，不支持IE，不支持停止支持的浏览器。</p> <div class="language- extra-class"><pre class="language-text"><code># .browserslistrc

&gt; 1%
last 2 version
not ie &lt;= 11
not ie_mob &lt;= 11
not op_mini all
not dead
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/22/2019, 7:17:09 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.8ecca066.js" defer></script><script src="/assets/js/2.9c7904de.js" defer></script><script src="/assets/js/3.ec261dc9.js" defer></script><script src="/assets/js/6.f65d0484.js" defer></script>
  </body>
</html>
